{% extends "base.html" %}

{% block title %}Prediction Results{% endblock %}

{% block content %}
<div class="card mt-4">
    <div class="card-header text-center">
        <h1 class="mb-0">
            <i class="fas fa-chart-pie me-2"></i>
            Prediction Results
        </h1>
    </div>
    <div class="card-body p-4">
        <div class="row">
            <div class="col-md-6">
                <div class="text-center mb-4">
                    {% if prediction.risk_level == "Low" %}
                    <div class="probability-circle probability-low">
                        {{ prediction.churn_probability }}%
                    </div>
                    {% elif prediction.risk_level == "Medium" %}
                    <div class="probability-circle probability-medium">
                        {{ prediction.churn_probability }}%
                    </div>
                    {% else %}
                    <div class="probability-circle probability-high">
                        {{ prediction.churn_probability }}%
                    </div>
                    {% endif %}
                    
                    <h3 class="mt-3">Churn Probability</h3>
                    <span class="badge risk-badge bg-{{ prediction.risk_color }}">
                        {{ prediction.risk_level }} Risk
                    </span>
                </div>

                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Risk Assessment</h5>
                    </div>
                    <div class="card-body">
                        {% if prediction.risk_level == "Low" %}
                        <div class="alert alert-success">
                            <h6><i class="fas fa-check-circle me-2"></i>Low Risk of Churn</h6>
                            <p class="mb-0">This customer has a low probability of churning. Continue providing excellent service and consider upselling opportunities.</p>
                        </div>
                        {% elif prediction.risk_level == "Medium" %}
                        <div class="alert alert-warning">
                            <h6><i class="fas fa-exclamation-triangle me-2"></i>Medium Risk of Churn</h6>
                            <p class="mb-0">This customer shows moderate churn risk. Proactively reach out to understand concerns and offer promotional discounts.</p>
                        </div>
                        {% else %}
                        <div class="alert alert-danger">
                            <h6><i class="fas fa-exclamation-circle me-2"></i>High Risk of Churn</h6>
                            <p class="mb-0">This customer has a high probability of churning. Immediate action required: customer outreach, retention packages, and service review.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Prediction Details</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-striped">
                            <tr>
                                <td><strong>Churn Probability:</strong></td>
                                <td>{{ prediction.churn_probability }}%</td>
                            </tr>
                            <tr>
                                <td><strong>No Churn Probability:</strong></td>
                                <td>{{ prediction.no_churn_probability }}%</td>
                            </tr>
                            <tr>
                                <td><strong>Predicted Class:</strong></td>
                                <td>
                                    {% if prediction.predicted_class == 1 %}
                                    <span class="badge bg-danger">Will Churn</span>
                                    {% else %}
                                    <span class="badge bg-success">Will Not Churn</span>
                                    {% endif %}
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                {% if feature_importance %}
                <div class="card mb-4">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0"><i class="fas fa-star me-2"></i>Top Factors</h5>
                    </div>
                    <div class="card-body">
                        <ol class="list-group list-group-numbered">
                            {% for feature, importance in feature_importance[:5] %}
                            <li class="list-group-item d-flex justify-content-between align-items-start">
                                <div class="ms-2 me-auto">
                                    <div class="fw-bold">{{ feature }}</div>
                                </div>
                                <span class="badge bg-primary rounded-pill">{{ "%.2f"|format(importance * 100) }}%</span>
                            </li>
                            {% endfor %}
                        </ol>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0"><i class="fas fa-user-circle me-2"></i>Customer Profile</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6>Basic Information</h6>
                        <ul class="list-unstyled">
                            <li><strong>Tenure:</strong> {{ input_data.tenure }} months</li>
                            <li><strong>Gender:</strong> {{ input_data.gender }}</li>
                            <li><strong>Senior Citizen:</strong> {{ "Yes" if input_data.SeniorCitizen == 1 else "No" }}</li>
                            <li><strong>Partner:</strong> {{ input_data.Partner }}</li>
                            <li><strong>Dependents:</strong> {{ input_data.Dependents }}</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6>Financial Information</h6>
                        <ul class="list-unstyled">
                            <li><strong>Monthly Charges:</strong> ${{ "%.2f"|format(input_data.MonthlyCharges) }}</li>
                            <li><strong>Total Charges:</strong> ${{ "%.2f"|format(input_data.TotalCharges) }}</li>
                            <li><strong>Contract:</strong> {{ input_data.Contract }}</li>
                            <li><strong>Payment Method:</strong> {{ input_data.PaymentMethod }}</li>
                            <li><strong>Paperless Billing:</strong> {{ input_data.PaperlessBilling }}</li>
                        </ul>
                    </div>
                    <div class="col-md-4">
                        <h6>Service Information</h6>
                        <ul class="list-unstyled">
                            <li><strong>Phone Service:</strong> {{ input_data.PhoneService }}</li>
                            <li><strong>Internet Service:</strong> {{ input_data.InternetService }}</li>
                            <li><strong>Tech Support:</strong> {{ input_data.TechSupport }}</li>
                            <li><strong>Online Security:</strong> {{ input_data.OnlineSecurity }}</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center">
            <a href="/" class="btn btn-primary btn-lg">
                <i class="fas fa-redo me-2"></i>Make Another Prediction
            </a>
        </div>
    </div>
</div>
{% endblock %}

